<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><title>解决live2D相关问题的记录贴 | 宅日记</title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><meta content="telephone=no" name="format-detection"><meta content="on" http-equiv="x-dns-prefetch-control"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="live2d相关问题的解决方法"><meta property="og:type" content="article"><meta property="og:title" content="解决live2D相关问题的记录贴"><meta property="og:url" content="https://crosschannel.cc/daily/blog-add-live2d.html"><meta property="og:site_name" content="宅日记"><meta property="og:description" content="live2d相关问题的解决方法"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pic.rmb.bdstatic.com/bjh/8674949eedfdb35002cbbaee7e070cee.jpeg@s_0,w_2000"><meta property="article:published_time" content="2021-01-19T08:47:00.000Z"><meta property="article:modified_time" content="2021-01-21T15:57:54.526Z"><meta property="article:author" content="某个不知名的肥宅"><meta property="article:tag" content="Hexo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.rmb.bdstatic.com/bjh/8674949eedfdb35002cbbaee7e070cee.jpeg@s_0,w_2000"><link rel="canonical" href="https://crosschannel.cc/daily/blog-add-live2d.html"><link crossorigin="" href="https://cdn.jsdelivr.net" rel="preconnect"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/other.css" media="print" onload='this.media="all",this.onload=null'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all",this.onload=null'><link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"><link rel="shortcut icon" type="image/ico" href="/favicon.ico"><script src="/js/main.js" defer="defer"></script><script>"dark"===localStorage.getItem("theme")?document.documentElement.setAttribute("data-theme","dark"):21<=(new Date).getHours()||(new Date).getHours()<7?document.documentElement.setAttribute("data-theme","dark"):matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.setAttribute("data-theme","dark")</script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="loading-bar"><div class="progress"></div></div><div id="sidebar"><header id="site-head"><h1 class="site-title"> <a href="/">宅日记</a></h1><p class="site-description">一个不知名懒肥宅的自留地</p> <button class="iconfont iconcaidan" id="secondary-toggle"></button></header><div id="secondary" aria-expanded="false"><nav id="memu"> <a href="/categories/gal/" class="menu-item">galgame</a> <a href="/categories/%E5%8A%A8%E7%94%BB/" class="menu-item">动画</a> <a href="/categories/%E6%97%A5%E5%B8%B8/" class="menu-item">日常</a> <a href="/aboutme.html" class="menu-item">关于</a> <a href="/links.html" class="menu-item">友链</a></nav><meting-js class="meting" id="2382854733" server="netease" type="playlist" order="random" volume="0.3" preload="none" list-max-height="200px" list-folded="true" lrc-type="false" theme="#00b9f1"></meting-js><form id="search-form" method="GET" action="/search.html" autocomplete="off"> <input id="search-input" type="search" placeholder="search..." name="s" value=""></form><aside id="tagcloud"><h3 class="widget-title">标签云</h3> <a href="/tags/Hexo/" style="font-size:2.2rem">Hexo</a> <a href="/tags/%E4%BA%BA%E7%B1%BB%E5%9C%A3%E7%BB%8F/" style="font-size:.9rem">人类圣经</a> <a href="/tags/%E5%85%A8%E5%B9%B4%E9%BE%84/" style="font-size:2.01rem">全年龄</a> <a href="/tags/%E5%9E%8B%E6%9C%88/" style="font-size:.9rem">型月</a> <a href="/tags/%E5%A5%88%E9%A1%BB%E8%98%91%E8%8F%87/" style="font-size:.9rem">奈须蘑菇</a> <a href="/tags/%E6%B2%BB%E6%84%88/" style="font-size:1.09rem">治愈</a> <a href="/tags/%E6%BF%91%E6%88%B7%E5%8F%A3%E5%BB%89%E4%B9%9F/" style="font-size:1.64rem">濑户口廉也</a> <a href="/tags/%E7%94%B0%E4%B8%AD%E7%BD%97%E5%AF%86%E6%AC%A7/" style="font-size:1.83rem">田中罗密欧</a> <a href="/tags/%E7%A5%9E%E4%BD%9C/" style="font-size:1.46rem">神作</a> <a href="/tags/%E7%BE%BD%E6%B5%B7%E9%87%8E%E5%8D%83%E8%8A%B1/" style="font-size:1.27rem">羽海野千花</a> <a href="/tags/%E8%87%B4%E9%83%81/" style="font-size:1.64rem">致郁</a> <a href="/tags/%E9%83%BD%E5%90%88%E4%B8%BB%E4%B9%89/" style="font-size:.9rem">都合主义</a></aside><a id="friend-link" href="/" rel="noopener external noreferrer" target="_blank" style="display:none"><span id="friend-name"></span> -<span id="friend-desc"></span></a></div></div><main id="main" class="site-main"><article class="posts"><header class="posts-header"><h2 class="posts-title"> <a class="post-title-link" href="/daily/blog-add-live2d.html">解决live2D相关问题的记录贴</a></h2></header><div class="posts-content"><p><img src="https://pic.rmb.bdstatic.com/bjh/8674949eedfdb35002cbbaee7e070cee.jpeg@s_0,w_2000" alt="fate" class="lazyload" srcset="https://cdn.jsdelivr.net/gh/track23/blog-static/img/lazy.png" data-srcset="https://pic.rmb.bdstatic.com/bjh/8674949eedfdb35002cbbaee7e070cee.jpeg@s_0,w_2000"></p><p>关于live2D，我知道的都在这里了。</p><a id="more"></a><div class="admonition note"><p class="admonition-title">前言</p><p>以下内容仅针对live2D在web上的情况。live2D版本为2.0。</p><p>如果不懂怎么给页面添加live2d，那么此文章不适合你。</p></div><h3 id="出自谁手"><a href="#出自谁手" class="headerlink" title="出自谁手"></a>出自谁手</h3><p><code>live2d.js</code> 这个核心文件提供了 <code>loadlive2d</code> 函数，通过这个函数可以很方便的让live2D显示在页面上。</p><p>首先可以确定这个js不是live2D官方提供的<del>看过官网SDK的都懂</del>，网上live2D相关的文章都是只给了个js，没有源码。只有<a target="_blank" rel="noopener external nofollow noreferrer" href="https://nocilol.me/archives/lab/add-dynamic-poster-girl-with-live2d-to-your-blog-02/">imjad</a>大佬的文章提到了是他对<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/EYHN/hexo-helper-live2d">hexo-helper-live2d</a> 这个项目二次开发。</p><p>不过 <code>hexo-helper-live2d</code> 这个项目好像是根据 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/xiazeyu/live2d-widget.js">live2d-widget</a> 二次开发的。所以真想看源码的可以去看看这2个项目<del>好像已经弃坑</del>。官方版本号都到4了。</p><p>网上的 <code>live2d.js</code> 我猜测都是imjad大佬这个版本改出来的。因为前面提到的项目里没有 <code>loadlive2d</code> 函数，想在页面上加载live2D模型都挺麻烦。而且 模型文件里<code>hit_areas_custom</code> 这个字段是imjad大佬增加的，官方模型里没有这个。</p><h3 id="loadlive2d"><a href="#loadlive2d" class="headerlink" title="loadlive2d"></a>loadlive2d</h3><p>这个函数接收3个参数，目标canvas的选择器，模型json文件，回调函数。</p><p>很多人想要的换模型/衣服功能都是重新调这个函数实现的。只需要改变第二个参数。可以是绝对地址或相对地址。如果不通过后端动态返回文件，就只能和我一样每套贴图对应一个json文件<del>很傻B，但是没办法</del>。</p><p>模型换衣服就是改模型json文件中 <code>textures</code> 这个数组里的图片，可以使用图床地址。虽然这个字段的值是数组，但是不能把全部贴图放进去，没有用，一个模型json文件只能放一个造型，可以把一个造型的图片分成多张图，但不能放多个造型进去。</p><p>如果不懂代码，那么直接使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/fghrsh/live2d_demo">fghrsh</a> 提供的api吧，缺点就是只能使用他提供的那几个模型，也不能改模型配置。想改就得自己部署后端。</p><p>如果不需要换模型功能，只加载一个模型,可以参考这个 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/galnetwen/Live2D">https://github.com/galnetwen/Live2D</a></p><h3 id="换模型-衣服"><a href="#换模型-衣服" class="headerlink" title="换模型/衣服"></a>换模型/衣服</h3><p>模型对应的贴图是有严格要求的，不能不同模型的混用，或者拿无关的图片代替。模型资源最底下有仓库地址。也可以用我修正过的。</p><p>因为我没有服务器，又不想使用别人的api提供的模型。所以换模型功能的实现的很蠢，每个模型/造型对应一个json文件，导致我live2d文件夹下100多个重复的json。</p><pre><code class="hljs javascript"><span class="hljs-keyword">const</span> live2dModel = [
  &#123;
    name: <span class="hljs-string">&#x27;aoba&#x27;</span>,
    textures: <span class="hljs-number">1</span>
  &#125;,
  &#123;
    name: <span class="hljs-string">&#x27;Pio&#x27;</span>,
    textures: <span class="hljs-number">65</span>,<span class="hljs-comment">// 准备了多少json就写多少，不能乱写</span>
  &#125;
];
<span class="hljs-keyword">let</span> currentModel = <span class="hljs-number">0</span>;
<span class="hljs-keyword">let</span> currentTextures = <span class="hljs-number">1</span>;</code></pre><p><code>name</code>代表模型存放的文件夹名字，<code>textures</code>则是该模型有多少模型json文件，按照model1.json往下增加。</p><p>下面2个函数是换模型/衣服的。绑定给对应按钮即可。</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeModel</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">if</span>(currentModel === live2dModel.length - <span class="hljs-number">1</span>) &#123;
    currentModel = <span class="hljs-number">-1</span>
  &#125;
  currentModel++;
  currentTextures = <span class="hljs-number">1</span>;
  loadlive2d(<span class="hljs-string">&quot;live2d&quot;</span>, <span class="hljs-string">`/live2d/<span class="hljs-subst">$&#123;live2dModel[currentModel].name&#125;</span>/model1.json`</span>);
&#125;
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">changeTextures</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">if</span> (live2dModel[currentModel].textures === <span class="hljs-number">1</span>) &#123;
    <span class="hljs-keyword">return</span>
  &#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-keyword">if</span>(currentTextures === live2dModel[currentModel].textures) &#123;
      currentTextures = <span class="hljs-number">0</span>
    &#125;
    currentTextures++;
    loadlive2d(<span class="hljs-string">&quot;live2d&quot;</span>, <span class="hljs-string">`/live2d/<span class="hljs-subst">$&#123;live2dModel[currentModel].name&#125;</span>/model<span class="hljs-subst">$&#123;currentTextures&#125;</span>.json`</span>);
  &#125;
&#125;</code></pre><h3 id="模型报错"><a href="#模型报错" class="headerlink" title="模型报错"></a>模型报错</h3><p><strong>Cannot read property ‘0’ of undefined</strong></p><p>这个情况出现于点击页面上模型区域以外的地方，原因是模型json文件中缺少 <code>hit_areas_custom</code> 这个字段。格式如下</p><pre><code class="hljs json">&quot;hit_areas_custom&quot;: &#123;
  &quot;head_x&quot;:[-0.16, 0.25],
  &quot;head_y&quot;:[0.43, -0.4],
  &quot;body_x&quot;:[-0.2, -0.6],
  &quot;body_y&quot;:[0.5, -1.2]
&#125;</code></pre><p><code>head_x</code> 是模型头部左上角，<code>head_y</code> 是模型头部右下角。可点击区域是长方形或正方形，坐标系原点是canvas正中间。imjad原文说debug_momdel可以获取坐标，但是我不知道怎么开启。只能盲猜。</p><p>点击头部会报错 <strong>Cannot read property ‘startMotion’ of null</strong></p><p>可能是web sdk的问题，把模型json文件中的 <code>hit_aresa</code> 这个字段删除，并且要保证有 <code>hit_areas_custom</code> 不然就无法触发模型的点击事件。</p><p><code>hit_aresa</code> 这个才是官方的，但是不知道为什么会报错，既然第三方提供了自己指定点击区域的方法，那么官方的可以删除。<code>hit_areas_custom</code> 只能指定head和body，其他位置不支持。</p><p>第三方web sdk只支持 idle，flick_head，tap_body，sleepy这几个事件。</p><h3 id="页面性能"><a href="#页面性能" class="headerlink" title="页面性能"></a>页面性能</h3><p>用了live2D 页面性能爆炸是逃不了的，移动端可以通过判断屏幕大小来决定是否加执行 <code>loadlive2d</code>。</p><p>只是不加载模型满足不了我。毕竟 live2d.js 这个文件就150kb。以下是我优化live2d的方法。</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadScript</span>(<span class="hljs-params">url, cb, isMoudule</span>) </span>&#123;
  <span class="hljs-keyword">const</span> script = <span class="hljs-built_in">document</span>.createElement(<span class="hljs-string">&#x27;script&#x27;</span>);
  script.src = url;
  <span class="hljs-keyword">if</span> (cb) script.onload = cb;
  <span class="hljs-keyword">if</span> (isMoudule) script.type = <span class="hljs-string">&#x27;module&#x27;</span>;
  script.async = <span class="hljs-literal">true</span>;
  <span class="hljs-built_in">document</span>.body.appendChild(script);
&#125;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initLive2d</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.screen.width &gt; <span class="hljs-number">950</span>) &#123;
    loadScript(<span class="hljs-string">&#x27;/js/live2d.min.js&#x27;</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>)</span>&#123;
      loadlive2d(<span class="hljs-string">&quot;live2d&quot;</span>, <span class="hljs-string">&quot;/live2d/model/tia/model.json&quot;</span>);
    &#125;
  &#125;
&#125;</code></pre><p><code>loadScript</code> 函数用来动态加载js文件，window.onload的时候执行 <code>initLive2d</code>即可。这样完全不会影响页面加载速度。其他js也可以用这个函数来懒加载。</p><p>live2D的模型贴图建议去 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://tinypng.com/">tinypng</a> 压缩一下。400多kb压缩到100kb完全不影响显示效果，我博客的模型贴图都是压缩过的。</p><p>也许有人发现了，我博客的live2d似乎比别人的更高清。其实和贴图质量无关，因为我的canva设置的大小是 800x800，然后再通过css设置height为340px把canvas缩小达到高清效果。</p><p>如果要缩放canvas，那么记得只能使用我博客这个live2d.js，其他版本的缩放canvas后无法正确触发点击事件，而且跟随鼠标的效果变得很僵硬。我这保存了好几个live2d.js，都是别人修改过的。我现在这个是谁修改的我也不清楚。。</p><h3 id="模型来源"><a href="#模型来源" class="headerlink" title="模型来源"></a>模型来源</h3><p>我的模型都是从这里下载的 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/imuncle/live2d">https://github.com/imuncle/live2d</a>。</p><p>关于live2d版本3的使用也可以参考这个仓库。</p><p>最后感谢 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://imjad.cn/">imjad</a> 和 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.fghrsh.net/">fghrsh</a> 2位大佬。</p><div class="license"><p class="license-title">解决live2D相关问题的记录贴</p><p class="license-link"><a href="https://crosschannel.cc/daily/blog-add-live2d.html">https://crosschannel.cc/daily/blog-add-live2d.html</a></p><div class="license-meta"><div class="license-meta-item"><div>本文作者</div><div>Track13</div></div><div class="license-meta-item"><div>发布于</div><div>2021-01-19</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a></div></div></div><p class="license-info">转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！</p><div class="iconfont iconcc_licenses"></div></div></div><footer id="posts-footer"> <span class="iconfont iconrili"><a href="" rel="bookmark"><time class="updated" datetime="2021-01-19T08:47:00.000Z">2021-01-19</time></a></span> <span class="iconfont iconwenjianjia"><a href="/categories/%E6%97%A5%E5%B8%B8/" rel="category tag">日常</a></span> <span class="iconfont iconbiaoqian"><a href="/tags/Hexo/" rel="category tag">Hexo</a></span><span class="iconfont iconeye"><span id="/daily/blog-add-live2d.html" class="leancloud_visitors" data-flag-title="解决live2D相关问题的记录贴"></span></span></footer></article><div id="comment"><p id="comments-title">《解决live2D相关问题的记录贴》上有<span id="comment-count"></span>条评论</p><div id="valine"></div><script>"function"==typeof loadValine&&loadValine()</script></div><nav id="post-navigation" role="navigation"> <a id="nav-next" href="/daily/2021.html"><span>下一篇</span> <span class="link-title">2021年更新日志</span></a></nav></main><footer id="footer"> powered by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> theme by <a href="/">Track13</a> inspired by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://wordpress.org/themes/twentyfifteen/">wordpress</a></footer><div id="back-top"><a href="#main"><i class="iconfont icontoparr"></i></a></div><div id="landlord" style="display:none;contain:layout"><div class="message" style="opacity:0"></div><canvas id="live2d" width="800" height="800" class="live2d"></canvas></div> <button id="xm"></button></body></html>