<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><title>面向小白的Hexo添加暗色模式教程 | 宅日记</title><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><meta content="telephone=no" name="format-detection"><meta content="on" http-equiv="x-dns-prefetch-control"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="面向小白的静态博客添加暗色模式教程"><meta property="og:type" content="article"><meta property="og:title" content="面向小白的Hexo添加暗色模式教程"><meta property="og:url" content="https://crosschannel.cc/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html"><meta property="og:site_name" content="宅日记"><meta property="og:description" content="面向小白的静态博客添加暗色模式教程"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"><meta property="article:published_time" content="2019-11-01T15:29:00.000Z"><meta property="article:modified_time" content="2021-01-01T07:40:28.024Z"><meta property="article:author" content="某个不知名的肥宅"><meta property="article:tag" content="Hexo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"><link rel="canonical" href="https://crosschannel.cc/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html"><link crossorigin="" href="https://cdn.jsdelivr.net" rel="preconnect"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/css/other.css" media="print" onload='this.media="all",this.onload=null'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload='this.media="all",this.onload=null'><link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"><link rel="shortcut icon" type="image/ico" href="/favicon.ico"><script src="/js/main.js" defer="defer"></script><script>"dark"===localStorage.getItem("theme")?document.documentElement.setAttribute("data-theme","dark"):21<=(new Date).getHours()||(new Date).getHours()<7?document.documentElement.setAttribute("data-theme","dark"):matchMedia("(prefers-color-scheme: dark)").matches&&document.documentElement.setAttribute("data-theme","dark")</script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="loading-bar"><div class="progress"></div></div><div id="sidebar"><header id="site-head"><h1 class="site-title"> <a href="/">宅日记</a></h1><p class="site-description">一个不知名懒肥宅的自留地</p> <button class="iconfont iconcaidan" id="secondary-toggle"></button></header><div id="secondary" aria-expanded="false"><nav id="memu"> <a href="/categories/gal/" class="menu-item">galgame</a> <a href="/categories/%E5%8A%A8%E7%94%BB/" class="menu-item">动画</a> <a href="/categories/%E6%97%A5%E5%B8%B8/" class="menu-item">日常</a> <a href="/aboutme.html" class="menu-item">关于</a> <a href="/links.html" class="menu-item">友链</a></nav><meting-js class="meting" id="2382854733" server="netease" type="playlist" order="random" volume="0.1" preload="none" list-max-height="200px" list-folded="true" lrc-type="false" theme="#00b9f1"></meting-js><form id="search-form" method="GET" action="/search.html" autocomplete="off"> <input id="search-input" type="search" placeholder="search..." name="s" value=""></form><aside id="tagcloud"><h3 class="widget-title">标签云</h3> <a href="/tags/Hexo/" style="font-size:2.2rem">Hexo</a> <a href="/tags/%E4%BA%BA%E7%B1%BB%E5%9C%A3%E7%BB%8F/" style="font-size:.9rem">人类圣经</a> <a href="/tags/%E5%85%A8%E5%B9%B4%E9%BE%84/" style="font-size:2.01rem">全年龄</a> <a href="/tags/%E5%9E%8B%E6%9C%88/" style="font-size:.9rem">型月</a> <a href="/tags/%E5%A5%88%E9%A1%BB%E8%98%91%E8%8F%87/" style="font-size:.9rem">奈须蘑菇</a> <a href="/tags/%E6%B2%BB%E6%84%88/" style="font-size:1.09rem">治愈</a> <a href="/tags/%E6%BF%91%E6%88%B7%E5%8F%A3%E5%BB%89%E4%B9%9F/" style="font-size:1.64rem">濑户口廉也</a> <a href="/tags/%E7%94%B0%E4%B8%AD%E7%BD%97%E5%AF%86%E6%AC%A7/" style="font-size:1.83rem">田中罗密欧</a> <a href="/tags/%E7%A5%9E%E4%BD%9C/" style="font-size:1.46rem">神作</a> <a href="/tags/%E7%BE%BD%E6%B5%B7%E9%87%8E%E5%8D%83%E8%8A%B1/" style="font-size:1.27rem">羽海野千花</a> <a href="/tags/%E8%87%B4%E9%83%81/" style="font-size:1.64rem">致郁</a> <a href="/tags/%E9%83%BD%E5%90%88%E4%B8%BB%E4%B9%89/" style="font-size:.9rem">都合主义</a></aside><a id="friend-link" href="/" rel="noopener external noreferrer" target="_blank" style="display:none"><span id="friend-name"></span> -<span id="friend-desc"></span></a></div></div><main id="main" class="site-main"><article class="posts"><header class="posts-header"><h2 class="posts-title"> <a class="post-title-link" href="/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html">面向小白的Hexo添加暗色模式教程</a></h2></header><div class="posts-content"><p><img src="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg" alt="美少女万华镜4" class="lazyload" srcset="https://cdn.jsdelivr.net/gh/track23/blog-static/img/lazy.png" data-srcset="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"></p><p>OPPO手机都有暗色模式了，你的博客居然还没有。</p><a id="more"></a><div class="admonition note"><p class="admonition-title">更新记录</p><p>2020/12/20</p><p>目前安卓上就chrome能正常使用媒体查询。其他浏览器检测到暗色模式就强制变黑。</p><p>当下浏览器为暗色模式而暗色模式的情况下，媒体查询等于没有一样。</p></div><h3 id="prefers-color-scheme"><a href="#prefers-color-scheme" class="headerlink" title="prefers-color-scheme"></a>prefers-color-scheme</h3><p><code>prefers-color-scheme</code> <strong>Safari（v12.1及以上版本），Chrome（v76及以上版本）和Firefox（v67及以上版本）</strong>都支持 。</p><pre><code class="hljs css"><span class="hljs-selector-pseudo">:root</span> &#123;
  <span class="hljs-attribute">--background-color</span>: <span class="hljs-number">#ededed</span>;
  <span class="hljs-attribute">--color-alpha</span>: <span class="hljs-number">#c3423f</span>;
&#125;
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme:</span> dark) &#123;
  <span class="hljs-selector-pseudo">:root</span> &#123;
    <span class="hljs-attribute">--background-color</span>: <span class="hljs-number">#111</span>;
    <span class="hljs-attribute">--text-color</span>: <span class="hljs-number">#ededed</span>;
  &#125;
&#125;
<span class="hljs-selector-tag">body</span> &#123;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--background-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
&#125;</code></pre><p>以上代码就是在根元素上定义了2个变量，然后在需要的地方使用。<code>@media (prefers-color-scheme: dark)</code>会在系统开启暗色模式的时候改变量的值。</p><p>虽然媒体查询的方法好用 , 但是不兼容低版本浏览器和系统 ，最重要的是不够灵活 。</p><p>写了个测试页面 , 开启暗色模式后打开页面 , 看到的div背景色是粉色则说明不支持媒体查询 .</p><p>div下面3行文本是通过js判断暗色模式是否开启 , 如果开启了暗色模式 , 正常情况应该是输出 true false “dark” .</p> <a href="/test/dark.html" rel="external nofollow noreferrer" target="_blank" style="color:#ff1493">暗色模式是否正常测试页面</a> 请右键新标签打开查看 。因为有pjax会直接在本页打开...<h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>在媒体查询之前很多博客的暗色模式都是使用这个方案 。不依赖媒体查询 。</p><p>参照几篇博客的文章折腾了一下 。与上面的媒体查询方案二选一 ，不要重复使用 。</p><p>参考过的文章好像都是动态博客 ，他们都使用cookie判断是否手动开启了暗色模式 ，但静态博客没必要使用cookie 。我改为使用localStorage 。并且判断当前环境是否处于暗色模式来兼容媒体查询方案 。</p><p>先说流程：</p><ul><li><p>定义好css变量，再把博客需要改变颜色的元素的css的color属性值改成对应变量。</p></li><li><p>按钮/媒体查询/时间 只要有一个符合条件就给html标签加上<code>dark</code> 这个class</p></li></ul><p>可以不使用css变量，直接 .dark加上要改变元素的选择器，但是这样要写一堆选择器。aplayer和valine要加<code>!important</code>才能让css生效。</p><pre><code class="hljs css"><span class="hljs-selector-pseudo">:root</span> &#123;
  <span class="hljs-attribute">--color</span>: <span class="hljs-number">#222</span>;
  <span class="hljs-attribute">--color-secondary</span>: <span class="hljs-number">#999</span>;
  <span class="hljs-attribute">--border-color</span>: <span class="hljs-number">#222</span>;
&#125;
<span class="hljs-comment">/*当html有dark 这个class的时候变量的值就会改变*/</span>
<span class="hljs-selector-class">.dark</span>&#123;
  <span class="hljs-attribute">--color</span>: <span class="hljs-number">#a09c9c</span>;
  <span class="hljs-attribute">--color-secondary</span>: <span class="hljs-number">#cbd0d8</span>;
  <span class="hljs-attribute">--border-color</span>: <span class="hljs-number">#a09c9c</span>;
&#125;
<span class="hljs-comment">/*颜色你们自己随意*/</span>
<span class="hljs-selector-tag">body</span>&#123;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--color);
&#125;</code></pre><p>给html加class是因为这样就可以把js写head里了。放body里不好看。</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">switchDarkMode</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">var</span> isDark = <span class="hljs-built_in">document</span>.documentElement.classList.toggle(<span class="hljs-string">&#x27;dark&#x27;</span>);
  <span class="hljs-keyword">if</span> (isDark) &#123;
    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;theme&#x27;</span>, <span class="hljs-string">&#x27;dark&#x27;</span>);
  &#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;theme&#x27;</span>, <span class="hljs-string">&#x27;light&#x27;</span>);
  &#125;
&#125;</code></pre><p>把<code>switchDarkMode</code>这个函数绑定给切换按钮就可以了。</p><pre><code class="hljs javascript"><span class="hljs-comment">// 这段代码放heade里</span>
<span class="hljs-keyword">if</span> (<span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;theme&#x27;</span>) === <span class="hljs-string">&#x27;dark&#x27;</span>) &#123;
  <span class="hljs-built_in">document</span>.documentElement.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>)
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getHours() &gt;= <span class="hljs-number">21</span> || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getHours() &lt; <span class="hljs-number">7</span>) &#123;
  <span class="hljs-built_in">document</span>.documentElement.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>)
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matchMedia(<span class="hljs-string">&#x27;(prefers-color-scheme: dark)&#x27;</span>).matches) &#123;
  <span class="hljs-built_in">document</span>.documentElement.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>)
&#125;</code></pre><p><code>matchMedia(&#39;(prefers-color-scheme: dark)&#39;).matches</code>是查询系统是否开启暗色模式。这样就没必要使用css媒体查询了。</p><p>第二个if里的时间条件，不需要的可以删除。</p><p>同样是白色 #fff 在chrome下比firefox更暗，firefox不支持改变滚动条样式。</p><p>同一个局域网内 , <code>hexo s</code> 后在手机浏览器打开 <code>http://ip:4000</code> 就可以在手机上预览效果 ，ip就是电脑的局域网ip。</p><p>折腾时参考过的文章</p><ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://web.dev/prefers-color-scheme">https://web.dev/prefers-color-scheme</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://imjad.cn/archives/code/add-night-mode-to-blog/">https://imjad.cn/archives/code/add-night-mode-to-blog/</a></li></ul><div class="license"><p class="license-title">面向小白的Hexo添加暗色模式教程</p><p class="license-link"><a href="https://crosschannel.cc/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html">https://crosschannel.cc/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html</a></p><div class="license-meta"><div class="license-meta-item"><div>本文作者</div><div>Track13</div></div><div class="license-meta-item"><div>发布于</div><div>2019-11-01</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" rel="noopener external nofollow noreferrer" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a></div></div></div><p class="license-info">转载或引用本文时请遵守许可协议，注明出处、不得用于商业用途！</p><div class="iconfont iconcc_licenses"></div></div></div><footer id="posts-footer"> <span class="iconfont iconrili"><a href="" rel="bookmark"><time class="updated" datetime="2019-11-01T15:29:00.000Z">2019-11-01</time></a></span> <span class="iconfont iconwenjianjia"><a href="/categories/%E6%97%A5%E5%B8%B8/" rel="category tag">日常</a></span> <span class="iconfont iconbiaoqian"><a href="/tags/Hexo/" rel="category tag">Hexo</a></span><span class="iconfont iconeye"><span id="/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html" class="leancloud_visitors" data-flag-title="面向小白的Hexo添加暗色模式教程"></span></span></footer></article><div id="comment"><p id="comments-title">《面向小白的Hexo添加暗色模式教程》上有<span id="comment-count"></span>条评论</p><div id="valine"></div><script>setTimeout(function(){"function"==typeof loadValine&&loadValine()},200)</script></div><nav id="post-navigation" role="navigation"> <a id="nav-prev" href="/animation/青春野狼.html"><span>上一篇</span> <span class="link-title">青春猪头少年不会梦到兔女郎学姐</span></a> <a id="nav-next" href="/animation/此时此刻的我.html"><span>下一篇</span> <span class="link-title">此时此刻的我</span></a></nav></main><footer id="footer"> powered by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> theme by <a href="/">Track13</a> inspired by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://wordpress.org/themes/twentyfifteen/">wordpress</a></footer><div id="back-top"><a href="#main"><i class="iconfont icontoparr"></i></a></div><div id="landlord" style="display:none;contain:layout"><div class="message" style="opacity:0"></div><canvas id="live2d" width="800" height="800" class="live2d"></canvas></div> <button id="xm"></button></body></html>