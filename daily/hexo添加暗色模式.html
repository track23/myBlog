<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><title>面向小白的Hexo添加暗色模式教程 | 宅日记</title><meta name="description" content="面向小白的静态博客添加暗色模式教程"><meta property="og:type" content="article"><meta property="og:title" content="面向小白的Hexo添加暗色模式教程"><meta property="og:url" content="https://crosschannel.cc/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html"><meta property="og:site_name" content="宅日记"><meta property="og:description" content="面向小白的静态博客添加暗色模式教程"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/track23/blog-static/alu/%E5%93%AD%E6%B3%A3.png"><meta property="article:published_time" content="2019-11-01T15:29:00.000Z"><meta property="article:modified_time" content="2020-05-15T10:15:30.712Z"><meta property="article:author" content="某个不知名的肥宅"><meta property="article:tag" content="Hexo"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"><meta content="IE=edge" http-equiv="X-UA-Compatible"><meta content="telephone=no" name="format-detection"><meta content="on" http-equiv="x-dns-prefetch-control"><link crossorigin="" href="https://cdn.jsdelivr.net" rel="preconnect"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload='this.media="all",this.onload=null'><link rel="stylesheet" href="/css/other.css" media="print" onload='this.media="all",this.onload=null'><link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml"><link rel="shortcut icon" type="image/ico" href="/favicon.ico"><script src="/js/main.js" defer="defer"></script><script>
      if(localStorage.getItem('theme') === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
      } else if (new Date().getHours() >= 21 || new Date().getHours() < 7) {
        document.documentElement.setAttribute('data-theme', 'dark');
      } else if (matchMedia('(prefers-color-scheme: dark)').matches) {
        document.documentElement.setAttribute('data-theme', 'dark');
      }
      const foo = {};
      const message_Path = 'https://cdn.jsdelivr.net/gh/track23/blog-static/live2d/';
      const home_Path = 'https://crosschannel.cc/';
  </script><meta name="generator" content="Hexo 5.2.0"></head><body><div class="loading-bar"><div class="progress"></div></div><div id="sidebar"><header id="site-head"><h1 class="site-title"> <a href="/">宅日记</a></h1><p class="site-description">一个不知名懒肥宅的自留地</p> <button class="iconfont iconcaidan" id="secondary-toggle"></button></header><div id="secondary" aria-expanded="false"><nav id="memu"> <a href="/categories/gal/" class="menu-item">galgame</a> <a href="/categories/%E5%8A%A8%E7%94%BB/" class="menu-item">动画</a> <a href="/categories/%E6%97%A5%E5%B8%B8/" class="menu-item">日常</a> <a href="/aboutme.html" class="menu-item">关于</a> <a href="/links.html" class="menu-item">友链</a></nav><meting-js class="meting" id="2382854733" server="netease" type="playlist" order="random" volume="0.3" preload="none" list-max-height="200px" list-folded="true" lrc-type="false" theme="#00b9f1"></meting-js><form id="search-form" method="GET" action="/search.html" autocomplete="off"> <input id="search-input" type="search" placeholder="search..." name="s" value=""></form><aside id="tagcloud"><h3 class="widget-title">标签云</h3> <a href="/tags/Hexo/" style="font-size:1.77rem">Hexo</a> <a href="/tags/%E4%BA%BA%E7%B1%BB%E5%9C%A3%E7%BB%8F/" style="font-size:.9rem">人类圣经</a> <a href="/tags/%E5%85%A8%E5%B9%B4%E9%BE%84/" style="font-size:2.2rem">全年龄</a> <a href="/tags/%E5%9E%8B%E6%9C%88/" style="font-size:.9rem">型月</a> <a href="/tags/%E5%A5%88%E9%A1%BB%E8%98%91%E8%8F%87/" style="font-size:.9rem">奈须蘑菇</a> <a href="/tags/%E6%B2%BB%E6%84%88/" style="font-size:1.12rem">治愈</a> <a href="/tags/%E6%BF%91%E6%88%B7%E5%8F%A3%E5%BB%89%E4%B9%9F/" style="font-size:1.77rem">濑户口廉也</a> <a href="/tags/%E7%94%B0%E4%B8%AD%E7%BD%97%E5%AF%86%E6%AC%A7/" style="font-size:1.98rem">田中罗密欧</a> <a href="/tags/%E7%A5%9E%E4%BD%9C/" style="font-size:1.55rem">神作</a> <a href="/tags/%E7%BE%BD%E6%B5%B7%E9%87%8E%E5%8D%83%E8%8A%B1/" style="font-size:1.33rem">羽海野千花</a> <a href="/tags/%E8%87%B4%E9%83%81/" style="font-size:1.77rem">致郁</a> <a href="/tags/%E9%83%BD%E5%90%88%E4%B8%BB%E4%B9%89/" style="font-size:.9rem">都合主义</a></aside><a id="friend-link" href="/" rel="noopener external noreferrer" target="_blank"><span id="friend-name"></span> -<span id="friend-desc"></span></a></div></div><main id="main" class="site-main"><article class="posts"><header class="posts-header"><h2 class="posts-title"> <a class="post-title-link" href="/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html">面向小白的Hexo添加暗色模式教程</a></h2></header><div class="posts-content"><p><img src="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg" alt="美少女万华镜4" class="lazyload" srcset="https://cdn.jsdelivr.net/gh/track23/blog-static/img/lazy.png" data-srcset="https://pic.rmb.bdstatic.com/4319071cbda8fa028050d2585a7654c2.jpeg"></p><p>OPPO手机都有暗色模式了，你的博客居然还没有。<br><a id="more"></a></p><div class="admonition note"><p class="admonition-title">更新记录</p><p>2020/04/17</p><p>目前安卓上就chrome能正常使用媒体查询。其他浏览器即使内核支持但是没效果。</p></div><p>转载请带上出处，别用没有照抄这个理由来敷衍我。</p><p>封面与内容无关，我找不到好看的封面图了。<img src="https://cdn.jsdelivr.net/gh/track23/blog-static/alu/%E5%93%AD%E6%B3%A3.png" alt="555" class="lazyload" srcset="https://cdn.jsdelivr.net/gh/track23/blog-static/img/lazy.png" data-srcset="https://cdn.jsdelivr.net/gh/track23/blog-static/alu/%E5%93%AD%E6%B3%A3.png"></p><p>valine真是让我无语了。这篇文章一直出不来评论框，找了10几分钟原因发现是代码块里不能写注释。。</p><p>在tg群看见别人给博客加上了暗色模式，搜索一番得出下面几个方案。</p><ul><li>prefers-color-scheme 媒体查询</li><li>给body加class</li><li><del>disabled配合备用css</del></li></ul><p>虽然媒体查询的方法好用 , 但是 不兼容低版本浏览器和系统 . 最重要的是不够灵活 .</p><p>disabled配合备用css 之前我用的就是这个方法 , 不需要动原css 操作方便 , 缺点就是增加了一个请求，并且按钮第一次点击没反应 . (不推荐使用)</p><p>安卓的暗色模式好像都是黑白高对比度的瞎眼模式 , oled屏幕再开启DC调光导致低亮度偏色,配合oled屏幕的纯黑背景的拖影…我用了一次就再也没有开启过暗色模式 . 各位选配色的时候记住不要学这种反面例子 .</p><p>win 10开启暗色模式 , 个性化–&gt;颜色–&gt;默认应用模式 .</p><h3 id="坑"><a href="#坑" class="headerlink" title="坑"></a>坑</h3><p><code>prefers-color-scheme</code> <strong>Safari（v12.1及以上版本），Chrome（v76及以上版本）和Firefox（v67及以上版本）</strong>都支持 .</p><p>我手机 ColorOS 7 , 安卓10 , 系统webview版本80 , 使用套壳的via浏览器发现这个媒体查询在vai上无效 . 测试了很多浏览器就chrome能正常显示 . 而且在不同安卓好像对app的暗色模式还有单独按钮开启 . 导致这个媒体查询几乎就是个摆设 .</p><p>在via的issues看见有人反馈过这个问题。开发者说3.9.9版本处理，但是我更新到这个版本也没效果。其他浏览器大概也是这个原因吧。</p><p>写了个测试页面 , 开启暗色模式后打开页面 , 看到的div背景色是粉色则说明不支持媒体查询 .</p><p>div下面3行文本是通过js判断暗色模式是否开启 , 如果开启了暗色模式 , 正常情况应该是输出 true false “dark” .</p> <a href="/test/dark.html" rel="external nofollow noreferrer" target="_blank" style="color:#ff1493">暗色模式是否正常测试页面</a> 请右键新标签打开查看 . 因为有pjax会直接在本页打开...<h3 id="prefers-color-scheme-媒体查询"><a href="#prefers-color-scheme-媒体查询" class="headerlink" title="prefers-color-scheme 媒体查询"></a>prefers-color-scheme 媒体查询</h3><p>这应该是省事的方案 , 但目前安卓手机上只有chrome支持。</p><pre><code class="hljs css"><span class="hljs-selector-pseudo">:root</span> &#123;
  <span class="hljs-attribute">--background-color</span>: <span class="hljs-number">#ededed</span>;
  <span class="hljs-attribute">--page-background</span>: <span class="hljs-number">#fff</span>;
  <span class="hljs-attribute">--text-color</span>: <span class="hljs-number">#212121</span>;
  <span class="hljs-attribute">--color-alpha</span>: <span class="hljs-number">#c3423f</span>;
&#125;
<span class="hljs-keyword">@media</span> (<span class="hljs-attribute">prefers-color-scheme:</span> dark) &#123;
  <span class="hljs-selector-pseudo">:root</span> &#123;
    <span class="hljs-attribute">--background-color</span>: <span class="hljs-number">#111</span>;
    <span class="hljs-attribute">--page-background</span>: <span class="hljs-number">#212121</span>;
    <span class="hljs-attribute">--text-color</span>: <span class="hljs-number">#ededed</span>;
    <span class="hljs-attribute">--color-alpha</span>: <span class="hljs-number">#50a8d8</span>;
  &#125;
&#125;
<span class="hljs-selector-tag">body</span> &#123;
  <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">var</span>(--background-color);
  <span class="hljs-attribute">color</span>: <span class="hljs-built_in">var</span>(--text-color);
&#125;</code></pre><p>这种方案就是在全局定义好 css的变量 , 媒体查询检测到系统是暗色模式就会给变量重新赋值 .</p><p>也可以不使用css变量,直接在媒体查询里写覆盖的样式.</p><h3 id="class"><a href="#class" class="headerlink" title="class"></a>class</h3><p>在媒体查询之前很多博客的暗色模式都是使用这个方案 . 不依赖媒体查询 .</p><p>参照几篇博客的文章折腾了一下 . 与上面的 媒体查询方案二选一 , 不要重复使用 .</p><p>参考过的文章好像都是动态博客 , 他们都使用cookie判断是否手动开启了暗色模式 , 但静态博客没必要使用cookie . 我改为使用localStorage . 并且 使用 <code>matchMedia(&#39;(prefers-color-scheme: dark)&#39;).matches</code> 判断当前环境是否暗色模式来兼容媒体查询方案 .。</p><p><strong>需要配合后面的js才有效</strong> . 原来的css不需要改动 , 覆盖的样式在css 选择器前面加上 body.dark</p><pre><code class="hljs css"><span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.dark</span> &#123;<span class="hljs-attribute">background</span>: <span class="hljs-number">#2f3742</span>;&#125;
<span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.dark</span> <span class="hljs-selector-class">.aplayer</span>&#123;<span class="hljs-attribute">background</span>: <span class="hljs-number">#2f3742</span><span class="hljs-meta">!important</span>;&#125;
<span class="hljs-selector-tag">body</span><span class="hljs-selector-class">.dark</span> <span class="hljs-selector-tag">img</span> &#123;
  <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">brightness</span>(<span class="hljs-number">50%</span>);
&#125;</code></pre><p>aplayer valine要加<code>!important</code>才能让css生效。</p><p>这种方法也可以使用css变量 , 不过变量重新赋值不能写在媒体查询里 , 因为系统没有开启暗色模式就没办法重新赋值 . 可以在 :root body.dark 里重新赋值<del>可能记错了</del></p><p>虽然使用css变量很方便维护, 但是把原来固定的值一个个改为变量也很麻烦, 所以我选择不使用变量 , 直接写样式覆盖 . 全部替换我不敢用,一个颜色在几个地方使用就会出问题…</p><p><strong>与之前css配合的js部分</strong></p><p>在主题的layout.ejs文件中找到body标签的开始标签在后面加上这些js .</p><pre><code class="hljs js"><span class="hljs-keyword">if</span> (<span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;dark&#x27;</span>) === <span class="hljs-string">&#x27;1&#x27;</span>) &#123;
  <span class="hljs-built_in">document</span>.body.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>);
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getHours() &gt;= <span class="hljs-number">22</span> || <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getHours() &lt; <span class="hljs-number">7</span>) &#123;
  <span class="hljs-built_in">document</span>.body.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>);
&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (matchMedia(<span class="hljs-string">&#x27;(prefers-color-scheme: dark)&#x27;</span>).matches) &#123;
  <span class="hljs-built_in">document</span>.body.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>);
&#125;</code></pre><p>手动，时间范围，媒体查询我都用了. 有不需要的部分自行删减. 必须得是body开始标签后面，放head里不行，因为文档还没有渲染到body，放页面底部后面会导致页面闪白时间太长。没有使用pjax的博客建议不要给背景色变化加过渡，每个页面都是独立的，加了过渡动画会导致每次切换页面都播放过渡效果.</p><p>到这里利用class添加暗色模式已经完成了,其实和媒体查询方案差不多 , 只是覆盖原css的样式没有写在媒体查询里而已.</p><p><strong>暗色模式切换按钮</strong></p><p>屏幕左下角的小埋是手动开关，以前看到过别人博客底部的蕾姆，拉姆的至顶至底按钮正好合适拿来作夜间模式开关，翻友链里别人的博客，雷姆没有找到，小埋倒是有一只 .</p><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;xm&quot;</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;/images/xm.png&quot;</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></code></pre><p>按钮的css</p><pre><code class="hljs css"><span class="hljs-selector-id">#xm</span> &#123;
  <span class="hljs-attribute">cursor</span>: pointer;
  <span class="hljs-attribute">position</span>: fixed;
  <span class="hljs-attribute">bottom</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">left</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;
  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">0</span>;
  <span class="hljs-attribute">transition</span>: all <span class="hljs-number">0.3s</span> ease-in-out;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">3px</span>);
&#125;
<span class="hljs-selector-id">#xm</span><span class="hljs-selector-pseudo">:hover</span> &#123;
  <span class="hljs-attribute">transform</span>: <span class="hljs-built_in">translateY</span>(<span class="hljs-number">0</span>);
&#125;
<span class="hljs-selector-id">#xm</span> <span class="hljs-selector-tag">img</span> &#123;
  <span class="hljs-attribute">width</span>: <span class="hljs-number">50px</span>;
&#125;</code></pre><p>按钮的js , 添加到body底部或者独立的js文件都可以.</p><pre><code class="hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">switchNightMode</span>(<span class="hljs-params"></span>) </span>&#123;
  <span class="hljs-keyword">var</span> body = <span class="hljs-built_in">document</span>.body;
  <span class="hljs-keyword">if</span>(body.classList.contains(<span class="hljs-string">&#x27;dark&#x27;</span>))&#123;
    <span class="hljs-built_in">document</span>.body.classList.remove(<span class="hljs-string">&#x27;dark&#x27;</span>);
    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;dark&#x27;</span>,<span class="hljs-string">&#x27;0&#x27;</span>);
  &#125; <span class="hljs-keyword">else</span> &#123;
    <span class="hljs-built_in">document</span>.body.classList.add(<span class="hljs-string">&#x27;dark&#x27;</span>);
    <span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&#x27;dark&#x27;</span>,<span class="hljs-string">&#x27;1&#x27;</span>);
  &#125;
&#125;
<span class="hljs-keyword">var</span> xm = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;xm&quot;</span>);
xm.onclick = switchNightMode;</code></pre><p>小埋的图右键从我这里另存为就可以了 . 自己搞个喜欢的按钮也行 .</p><p>同样是白色 #fff 在chrome下比firefox更暗，firefox不支持改变滚动条样式，简直丑爆了。</p><p>同一个局域网内 , <code>hexo s</code> 后在手机浏览器打开 <code>http://ip:4000</code> 就可以在手机上预览效果 . ip就是电脑的局域网ip .</p><p>折腾时参考过的文章如下</p><ul><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://qqdie.com/archives/night-mode-of-website.html">https://qqdie.com/archives/night-mode-of-website.html</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://web.dev/prefers-color-scheme">https://web.dev/prefers-color-scheme</a></li><li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://imjad.cn/archives/code/add-night-mode-to-blog/">https://imjad.cn/archives/code/add-night-mode-to-blog/</a></li></ul></div><footer id="posts-footer"> <span class="iconfont iconrili"><a href="" rel="bookmark"><time class="updated" datetime="2019-11-01T15:29:00.000Z">2019-11-01</time></a></span> <span class="iconfont iconwenjianjia"><a href="/categories/%E6%97%A5%E5%B8%B8/" rel="category tag">日常</a></span> <span class="iconfont iconbiaoqian"><a href="/tags/Hexo/" rel="category tag">Hexo</a></span><span class="iconfont iconeye"><span id="/daily/hexo%E6%B7%BB%E5%8A%A0%E6%9A%97%E8%89%B2%E6%A8%A1%E5%BC%8F.html" class="leancloud_visitors" data-flag-title="面向小白的Hexo添加暗色模式教程"></span></span></footer></article><div id="comment"><p id="comments-title">《面向小白的Hexo添加暗色模式教程》上有<span id="comment-count"></span>条评论</p><div id="valine"></div><script>"function"==typeof foo.loadValine&&foo.loadValine()</script></div><nav id="post-navigation" role="navigation"> <a id="nav-prev" href="/animation/青春野狼.html"><span>上一篇</span> <span class="link-title">青春猪头少年不会梦到兔女郎学姐</span></a> <a id="nav-next" href="/animation/此时此刻的我.html"><span>下一篇</span> <span class="link-title">此时此刻的我</span></a></nav></main><footer id="footer"> powered by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> theme by <a href="/">Track13</a> inspired by <a target="_blank" rel="noopener external nofollow noreferrer" href="https://wordpress.org/themes/twentyfifteen/">wordpress</a></footer><div id="back-top"><a href="#main"><i class="iconfont icontoparr"></i></a></div><div id="landlord" style="display:none;contain:layout"><div class="message" style="opacity:0"></div><canvas id="live2d" width="220" height="340" class="live2d"></canvas></div> <button id="xm"></button></body></html>